sap.ui.define(["au/com/bournedigital/developertest/controller/BaseController","sap/ui/model/json/JSONModel","sap/ui/core/routing/History","au/com/bournedigital/developertest/model/formatter"],function(e,t,i,o){"use strict";return e.extend("au.com.bournedigital.developertest.controller.Object",{formatter:o,onInit:function(){var e,i=new t({busy:true,delay:0,totalOrderAmount:0,objectViewLineItemTableNoDataText:this.getResourceBundle().getText("objectViewLineItemTableNoDataText"),lineItemListTitle:this.getResourceBundle().getText("lineItemListTitle")});this.getRouter().getRoute("object").attachPatternMatched(this._onObjectMatched,this);e=this.getView().getBusyIndicatorDelay();this.setModel(i,"objectView");this.getOwnerComponent().getModel().metadataLoaded().then(function(){i.setProperty("/delay",e)})},onShareInJamPress:function(){var e=this.getModel("objectView"),t=sap.ui.getCore().createComponent({name:"sap.collaboration.components.fiori.sharing.dialog",settings:{object:{id:location.href,share:e.getProperty("/shareOnJamTitle")}}});t.open()},onListUpdateFinished:function(e){var t,i=0,o=e.getParameter("total"),n=this.getModel("objectView"),r=e.getSource().getBinding("items"),a;if(r.isLengthFinal()){a=r.getContexts();i=a.reduce(this._calculateOrderTotal,0);n.setProperty("/totalOrderAmount",i)}},_onObjectMatched:function(e){var t=e.getParameter("arguments").objectId;this._bindView("/Orders"+t)},_bindView:function(e){var t=this.getModel("objectView"),i=this.getModel();this.getView().bindElement({path:e,parameters:{expand:"Customer,Order_Details"},events:{change:this._onBindingChange.bind(this),dataRequested:function(){i.metadataLoaded().then(function(){t.setProperty("/busy",true)})},dataReceived:function(){t.setProperty("/busy",false)}}})},_onBindingChange:function(){var e=this.getView(),t=this.getModel("objectView"),i=e.getElementBinding();if(!i.getBoundContext()){this.getRouter().getTargets().display("objectNotFound");return}var o=this.getResourceBundle(),n=e.getBindingContext().getObject(),r=n.OrderID,a=n.CustomerID;t.setProperty("/busy",false);t.setProperty("/saveAsTileTitle",o.getText("saveAsTileTitle",[a]));t.setProperty("/shareOnJamTitle",a);t.setProperty("/shareSendEmailSubject",o.getText("shareSendEmailObjectSubject",[r]));t.setProperty("/shareSendEmailMessage",o.getText("shareSendEmailObjectMessage",[a,r,location.href]))},_calculateOrderTotal:function(e,t){var i=t.getObject().Quantity*t.getObject().UnitPrice;i=i-i*t.getObject().Discount;return e+i}})});