sap.ui.define(["au/com/bournedigital/developertest/controller/BaseController","sap/ui/model/json/JSONModel","sap/ui/core/routing/History","au/com/bournedigital/developertest/model/formatter","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/core/Fragment"],function(e,t,i,o,s,n,r){"use strict";return e.extend("au.com.bournedigital.developertest.controller.Worklist",{formatter:o,onInit:function(){var e,i,o=this.byId("table");i=o.getBusyIndicatorDelay();this._aTableSearchState=[];e=new t({worklistTableTitle:this.getResourceBundle().getText("worklistTableTitle"),saveAsTileTitle:this.getResourceBundle().getText("saveAsTileTitle",this.getResourceBundle().getText("worklistViewTitle")),shareOnJamTitle:this.getResourceBundle().getText("worklistTitle"),shareSendEmailSubject:this.getResourceBundle().getText("shareSendEmailWorklistSubject"),shareSendEmailMessage:this.getResourceBundle().getText("shareSendEmailWorklistMessage",[location.href]),tableNoDataText:this.getResourceBundle().getText("tableNoDataText"),tableBusyDelay:0,employeeInfo:new t});this.setModel(e,"worklistView");o.attachEventOnce("updateFinished",function(){e.setProperty("/tableBusyDelay",i)})},onUpdateFinished:function(e){var t,i=e.getSource(),o=e.getParameter("total");if(o&&i.getBinding("items").isLengthFinal()){t=this.getResourceBundle().getText("worklistTableTitleCount",[o])}else{t=this.getResourceBundle().getText("worklistTableTitle")}this.getModel("worklistView").setProperty("/worklistTableTitle",t)},onPress:function(e){this._showObject(e.getSource())},onShareInJamPress:function(){var e=this.getModel("worklistView"),t=sap.ui.getCore().createComponent({name:"sap.collaboration.components.fiori.sharing.dialog",settings:{object:{id:location.href,share:e.getProperty("/shareOnJamTitle")}}});t.open()},onSearch:function(e){if(e.getParameters().refreshButtonPressed){this.onRefresh()}else{var t=[];var i;var o=e.getParameter("query");if(o&&o.length>0){t=[new s("ShipName",n.Contains,o),new s("Employee/FirstName",n.Contains,o),new s("Employee/LastName",n.Contains,o)];i=new s({filters:t,and:false})}if(!i){this._applySearch(t)}else{this._applySearch(i)}}},onRefresh:function(){var e=this.byId("table");e.getBinding("items").refresh()},onQuickView:function(e){var t=this.getView().getModel("worklistView").getProperty("/employeeInfo");var i=e.getSource().getBindingContext().getObject("Employee");t.setData(i);this._openQuickView(e,t)},_showObject:function(e){this.getRouter().navTo("object",{objectId:e.getBindingContext().getPath().substring("/Orders".length)})},_applySearch:function(e){var t=this.byId("table"),i=this.getModel("worklistView");t.getBinding("items").filter(e,"Application");if(e.length!==0){i.setProperty("/tableNoDataText",this.getResourceBundle().getText("worklistNoDataWithSearchText"))}},_openQuickView:function(e,t){var i=e.getSource(),o=this.getView();if(!this._pQuickView){this._pQuickView=r.load({id:o.getId(),name:"au.com.bournedigital.developertest.view.QuickView",controller:this}).then(function(e){o.addDependent(e);return e})}this._pQuickView.then(function(e){e.setModel(t);e.openBy(i)})}})});